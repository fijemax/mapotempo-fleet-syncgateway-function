











var _user = "static";

var doc = {
  "date_test": "21062017",
  "delivery_date": "2017-07-21T16:22:27.348Z",
  "device": "a",
  "location": {
    "lat": "45.0",
    "lon": "2.0"
  },
  "name": "a",
  "owner": "static",
  "type": "mission",
  "_rev": "3-f208bcdc0803d47a25876ca100ea2bde",
  "_id": "c"
};

function access(owner, channel) {
  // console.log("add acces to " + channel + " at " + owner);
}

function channel(str) {
  // console.log("channel : " + str);
}

function requireUser(user) {
  if(user !== _user)
    throw({forbidden : "Wrong User"});
}


// #################
// # TEST FUNCTION #
// #################
function test_sync_create() {
  try {
    sync_func(doc);
  }
  catch(e) {
    return false;
  }
  return true;
}

function test_sync_update() {
  var newDoc = Object.assign({}, doc);
  newDoc.name = "";

  try {
    sync_func(newDoc, doc);
  }
  catch(e) {
    return false;
  }
  return true;
}

function test_sync_update_try_change_user() {
  var newDoc = Object.assign({}, doc);
  newDoc.owner = "statoc";

  try {
    sync_func(newDoc, doc);
  }
  catch(e) {
    return true;
  }
  return false;
}

function test () {
  var tests = {
    test_sync_create,
    test_sync_update,
    test_sync_update_try_change_user
  } 

  var tests_res = [];

  // run test
  for (var test in tests) {
    tests_res[test] = tests[test]();
  }

  // analyze result
  for (var test in tests) {
    if(tests_res[test])
      console.log(test + " - " + "success");
    else
      console.warn(test + " - " + "fail");
  }
}

test()
